#!/usr/bin/env node
/**
 * Reads michelson/*.json (produced by compile-contracts.sh) and writes
 * TypeScript modules that export the contract code for Taquito originate().
 * Run from project root after ./scripts/compile-contracts.sh
 */
const fs = require("fs");
const path = require("path");

const ROOT = path.resolve(__dirname, "..");
const MICHELSON_DIR = path.join(ROOT, "client/src/lib/tezos/michelson");

const contracts = [
  { json: "bowers-marketplace.json", ts: "bowers-marketplace.ts" },
  { json: "bowers-open-edition.json", ts: "bowers-open-edition.ts" },
  { json: "bowers-allowlist.json", ts: "bowers-allowlist.ts" },
  { json: "bowers-bonding-curve.json", ts: "bowers-bonding-curve.ts" },
  { json: "bowers-unified.json", ts: "bowers-unified.ts" },
  { json: "bowers-mint-oe.json", ts: "bowers-mint-oe.ts" },
  { json: "bowers-mint-allowlist.json", ts: "bowers-mint-allowlist.ts" },
  { json: "bowers-mint-bonding-curve.json", ts: "bowers-mint-bonding-curve.ts" },
];

for (const { json, ts } of contracts) {
  const jsonPath = path.join(MICHELSON_DIR, json);
  const tsPath = path.join(MICHELSON_DIR, ts);
  if (!fs.existsSync(jsonPath)) {
    console.warn(`Skip ${ts}: ${json} not found. Run ./scripts/compile-contracts.sh first.`);
    continue;
  }
  const contract = JSON.parse(fs.readFileSync(jsonPath, "utf8"));
  // SmartPy output is [parameter, storage, code]. Taquito originate() expects this full array as code.
  const content = `// Generated by scripts/generate-michelson-ts.js - do not edit manually.
// Contract script: [parameter, storage, code]
export const code: unknown[] = ${JSON.stringify(contract)};
`;
  fs.writeFileSync(tsPath, content);
  console.log(`Wrote ${ts}`);
}
